(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{401:function(e,t,a){"use strict";a.r(t);var _=a(44),r=Object(_.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"更新日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新日志"}},[e._v("#")]),e._v(" 更新日志")]),e._v(" "),a("h2",{attrs:{id:"未发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#未发布"}},[e._v("#")]),e._v(" [未发布]")]),e._v(" "),a("h3",{attrs:{id:"新增"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("h3",{attrs:{id:"移除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除"}},[e._v("#")]),e._v(" 移除")]),e._v(" "),a("h3",{attrs:{id:"变动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#变动"}},[e._v("#")]),e._v(" 变动")]),e._v(" "),a("h3",{attrs:{id:"修复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("如果启用了 POST 检测，则访问日志（access_log）中不会记录 POST 请求，即丢失所有的 POST 请求的日志。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-4-1-2021-06-09-utc-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-1-2021-06-09-utc-0800"}},[e._v("#")]),e._v(" [5.4.1] - 2021-06-09 UTC+0800")]),e._v(" "),a("h3",{attrs:{id:"修复-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-2"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("当使用了 "),a("code",[e._v("error_page")]),e._v(" 配置时，内置变量的值可能会出错。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-4-0-2021-06-03-utc-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-0-2021-06-03-utc-0800"}},[e._v("#")]),e._v(" [5.4.0] - 2021-06-03 UTC+0800")]),e._v(" "),a("h3",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[e._v("#")]),e._v(" "),a("strong",[e._v("注意")])]),e._v(" "),a("p",[a("strong",[e._v("本次更新更换了 libinjection 的 clone 链接，新的链接为 "),a("a",{attrs:{href:"https://github.com/libinjection/libinjection.git",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/libinjection/libinjection.git"),a("OutboundLink")],1),e._v("。")])]),e._v(" "),a("h3",{attrs:{id:"新增-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-2"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("XSS 攻击防御（Powered By "),a("a",{attrs:{href:"https://github.com/libinjection/libinjection",target:"_blank",rel:"noopener noreferrer"}},[e._v("libinjection"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("h3",{attrs:{id:"变动-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#变动-2"}},[e._v("#")]),e._v(" 变动")]),e._v(" "),a("ul",[a("li",[e._v("增加内置变量计算相关的调试日志。")])]),e._v(" "),a("h3",{attrs:{id:"修复-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-3"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("POST 检测失效。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-3-2-2021-05-28-utc-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-2021-05-28-utc-0800"}},[e._v("#")]),e._v(" [5.3.2] - 2021-05-28 UTC+0800")]),e._v(" "),a("h3",{attrs:{id:"修复-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-4"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("内存损坏。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-3-1-2021-05-26-gmt-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-2021-05-26-gmt-0800"}},[e._v("#")]),e._v(" [5.3.1] - 2021-05-26 GMT+0800")]),e._v(" "),a("h3",{attrs:{id:"修复-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-5"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("有时即使正确安装了依赖也不能编译模块。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-3-0-2021-05-16-gmt-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-0-2021-05-16-gmt-0800"}},[e._v("#")]),e._v(" [5.3.0] - 2021-05-16 GMT+0800")]),e._v(" "),a("h3",{attrs:{id:"新增-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-3"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("新的配置："),a("code",[e._v("waf_under_attack")]),e._v("，当网站受到攻击时可以使用。")])]),e._v(" "),a("li",[a("p",[e._v("新的配置："),a("code",[e._v("waf_http_status")]),e._v("，用于设置请求被拦截后返回的 HTTP 状态码。")])]),e._v(" "),a("li",[a("p",[e._v("新的内置变量："),a("code",[e._v("$waf_blocking_log")]),e._v("，当请求被拦截其值时不为空字符串。")])])]),e._v(" "),a("h3",{attrs:{id:"变动-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#变动-3"}},[e._v("#")]),e._v(" 变动")]),e._v(" "),a("ul",[a("li",[e._v("更新了默认规则。")])]),e._v(" "),a("h3",{attrs:{id:"修复-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-6"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("CC 防护有时会失效。")])]),e._v(" "),a("li",[a("p",[e._v("Cookie 防护有时会失效。")])])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-1-2-2021-04-30-gmt-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-2021-04-30-gmt-0800"}},[e._v("#")]),e._v(" [5.1.2] - 2021-04-30 GMT+0800")]),e._v(" "),a("h3",{attrs:{id:"新增-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-4"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("支持检测 SQL 注入（Powered By "),a("a",{attrs:{href:"https://github.com/libinjection/libinjection",target:"_blank",rel:"noopener noreferrer"}},[e._v("libinjection"),a("OutboundLink")],1),e._v("）。你可以通过启用 "),a("code",[e._v("LIB-INJECTION")]),e._v(" 模式开启该功能，详见使用文档。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-1-1-2021-04-23-gmt-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-2021-04-23-gmt-0800"}},[e._v("#")]),e._v(" [5.1.1] - 2021-04-23 GMT+0800")]),e._v(" "),a("h3",{attrs:{id:"修复-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-7"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("URL 和 Referer 白名单规则失效。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-1-0-2021-04-20-gmt-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-0-2021-04-20-gmt-0800"}},[e._v("#")]),e._v(" [5.1.0] - 2021-04-20 GMT+0800")]),e._v(" "),a("h3",{attrs:{id:"新增-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-5"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("新的内置变量 "),a("code",[e._v("waf_log")]),e._v("，当本模块进行了检查时不为空字符串，反之则为空字符串，主要用于 "),a("code",[e._v("access_log")]),e._v(" 指令。")])]),e._v(" "),a("li",[a("p",[e._v("新的内置变量 "),a("code",[e._v("waf_spend")]),e._v("，记录本模块执行检查花费的时间（毫秒）。")])])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_5-0-0-2021-04-07-gmt-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-0-2021-04-07-gmt-0800"}},[e._v("#")]),e._v(" [5.0.0] - 2021-04-07 GMT+0800")]),e._v(" "),a("h3",{attrs:{id:"警告"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#警告"}},[e._v("#")]),e._v(" "),a("strong",[e._v("警告")])]),e._v(" "),a("p",[a("strong",[e._v("此版本包含不兼容的更新（breaking changes）。")])]),e._v(" "),a("h3",{attrs:{id:"新增-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-6"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("新增了模式 "),a("code",[e._v("CACHE")]),e._v("，启用此模式后会缓存每次检查的结果，提高性能。")])]),e._v(" "),a("li",[a("p",[e._v("新增了配置 "),a("code",[e._v("waf_cache")]),e._v(" 用于设置缓存相关的参数。")])]),e._v(" "),a("li",[a("p",[e._v("新增了配置 "),a("code",[e._v("waf_cc_deny")]),e._v("，用于设置 CC 防护相关的参数。")])]),e._v(" "),a("li",[a("p",[e._v("新增了配置 "),a("code",[e._v("waf_priority")]),e._v("，用来设置除了 POST 检查以外所有的检查项目的优先级。")])]),e._v(" "),a("li",[a("p",[e._v("当 CC 防护返回 503 状态码时会附上 "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Retry-After",target:"_blank",rel:"noopener noreferrer"}},[e._v("Retry-After"),a("OutboundLink")],1),e._v(" 响应头。")])])]),e._v(" "),a("h3",{attrs:{id:"移除-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除-2"}},[e._v("#")]),e._v(" 移除")]),e._v(" "),a("ul",[a("li",[e._v("废弃了配置 "),a("code",[e._v("waf_cc_deny_limit")]),e._v("，使用新的配置 "),a("code",[e._v("waf_cc_deny")]),e._v(" 替代。")])]),e._v(" "),a("h3",{attrs:{id:"变动-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#变动-4"}},[e._v("#")]),e._v(" 变动")]),e._v(" "),a("ul",[a("li",[e._v("互换了 CC 防护和 IP 白名单检查的默认优先级。")])]),e._v(" "),a("h3",{attrs:{id:"修复-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-8"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("修复了当 worker 进程数量大于一时的段错误。")])]),e._v(" "),a("li",[a("p",[e._v("修复了 CC 防护统计有时不准的错误。")])])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_4-0-0-2021-03-22-gmt-0800"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-0-2021-03-22-gmt-0800"}},[e._v("#")]),e._v(" [4.0.0] - 2021-03-22 GMT+0800")]),e._v(" "),a("h3",{attrs:{id:"警告-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#警告-2"}},[e._v("#")]),e._v(" "),a("strong",[e._v("警告")])]),e._v(" "),a("p",[a("strong",[e._v("此版本包含不兼容的更新（breaking changes）。")])]),e._v(" "),a("h3",{attrs:{id:"新增-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-7"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("为 "),a("code",[e._v("waf_mode")]),e._v(" 和 "),a("code",[e._v("waf_cc_deny_limit")]),e._v(" 增加了一些参数（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/368db2b26e9d2a910c06e77f892740cefe9556d3",target:"_blank",rel:"noopener noreferrer"}},[e._v("368db2b"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("h3",{attrs:{id:"移除-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除-3"}},[e._v("#")]),e._v(" 移除")]),e._v(" "),a("ul",[a("li",[e._v("废弃配置项 "),a("code",[e._v("waf_mult_mount")]),e._v("，该配置的功能已经合并到了配置项 "),a("code",[e._v("waf_mode")]),e._v(" 中。")])]),e._v(" "),a("h3",{attrs:{id:"变动-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#变动-5"}},[e._v("#")]),e._v(" 变动")]),e._v(" "),a("ul",[a("li",[e._v("给 "),a("code",[e._v("waf_mode")]),e._v(" 增加了一些参数。")])]),e._v(" "),a("h3",{attrs:{id:"修复-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-9"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("更正了内置变量 "),a("code",[e._v("waf_rule_details")]),e._v(" 的名称错误，该变量的名称在之前的版本代码中被设置为 "),a("code",[e._v("waf_rule_deatails")]),e._v("。")])]),e._v(" "),a("li",[a("p",[e._v("不再进行冗余的检测。")])]),e._v(" "),a("li",[a("p",[e._v("彻底解决了与 "),a("code",[e._v("ngx_http_rewrite_module")]),e._v(" 的兼容性问题。")])])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-1-6-2021-03-07"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-6-2021-03-07"}},[e._v("#")]),e._v(" [3.1.6] - 2021-03-07")]),e._v(" "),a("h3",{attrs:{id:"修复-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-10"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("更正规则的生效顺序（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/51c7824786c060f4b0dcffe77a4a1e04b775e04b",target:"_blank",rel:"noopener noreferrer"}},[e._v("51c7824"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-1-5-2021-03-03"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-2021-03-03"}},[e._v("#")]),e._v(" [3.1.5] - 2021-03-03")]),e._v(" "),a("h3",{attrs:{id:"修复-11"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-11"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("修复了 "),a("code",[e._v("config")]),e._v(" 脚本的一个错误，这个错误会导致不能正确地检查依赖项（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/075a27e4f7aaf7e78c45eac0c78c9634863be476#diff-b79606fb3afea5bd1609ed40b622142f1c98125abcfe89a76a661b0e8e343910",target:"_blank",rel:"noopener noreferrer"}},[e._v("075a27e"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-1-4-2021-03-02"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-2021-03-02"}},[e._v("#")]),e._v(" [3.1.4] - 2021-03-02")]),e._v(" "),a("h3",{attrs:{id:"改动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("ul",[a("li",[e._v("条件允许的情况下使用更安全的字符串处理函数以避免缓冲区溢出（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/177ae68cb019f47096e6065ec34aa0ef9be07567",target:"_blank",rel:"noopener noreferrer"}},[e._v("177ae68"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-1-3-2021-02-23"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-2021-02-23"}},[e._v("#")]),e._v(" [3.1.3] - 2021-02-23")]),e._v(" "),a("h3",{attrs:{id:"修复-12"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-12"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("改正规则的生效顺序（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/857ec84c6519d88d1c1a5560a244dceffd413f3f",target:"_blank",rel:"noopener noreferrer"}},[e._v("857ec84"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-1-2-2021-02-17"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-2021-02-17"}},[e._v("#")]),e._v(" [3.1.2] - 2021-02-17")]),e._v(" "),a("h3",{attrs:{id:"修复-13"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-13"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("修复了一个 bug，这个 bug 会导致当规则文件不具有可写权限时初始化失败（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/20acd27815d1f266d89c1557e93848c96117b8ff",target:"_blank",rel:"noopener noreferrer"}},[e._v("20acd27"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-1-1-2021-01-18"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-2021-01-18"}},[e._v("#")]),e._v(" [3.1.1] - 2021-01-18")]),e._v(" "),a("h3",{attrs:{id:"修复-14"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-14"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("兼容较低版本的 GCC（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/becbbe022b9f6efa606e720d7cbcd6c5d6f22c33",target:"_blank",rel:"noopener noreferrer"}},[e._v("becbbe0"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-1-0-2021-01-17"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-0-2021-01-17"}},[e._v("#")]),e._v(" [3.1.0] - 2021-01-17")]),e._v(" "),a("h3",{attrs:{id:"注意-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意-2"}},[e._v("#")]),e._v(" 注意")]),e._v(" "),a("ul",[a("li",[e._v("因为在 "),a("code",[e._v("v3.0.3")]),e._v(" 测试过程中新增了向下兼容的功能，所以 "),a("code",[e._v("v3.0.3")]),e._v(" 被跳过。")])]),e._v(" "),a("h3",{attrs:{id:"新增-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-8"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("增加调试日志便于排障（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bac1d026e9e902d9a49881e899cba4965f3388a4",target:"_blank",rel:"noopener noreferrer"}},[e._v("bac1d02"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("h3",{attrs:{id:"修复-15"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-15"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("修复了一个段错误（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/57d7719654caddc40ee655c797f0984f42c25495",target:"_blank",rel:"noopener noreferrer"}},[e._v("57d7719"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("li",[a("p",[e._v("更精确的访问频次统计（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/53d3b149a524252dbb9b8170e31f4b1f4895a6b7",target:"_blank",rel:"noopener noreferrer"}},[e._v("53d3b14"),a("OutboundLink")],1),e._v("）。")])])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-0-2-2021-01-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-2-2021-01-10"}},[e._v("#")]),e._v(" [3.0.2] - 2021-01-10")]),e._v(" "),a("h3",{attrs:{id:"注意-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意-3"}},[e._v("#")]),e._v(" 注意")]),e._v(" "),a("ul",[a("li",[e._v("因为在 "),a("code",[e._v("v3.0.1")]),e._v("上有热修复，所以 "),a("code",[e._v("v3.0.2")]),e._v(" 的一切测试版本作废，请不要使用这些测试版。")])]),e._v(" "),a("h3",{attrs:{id:"修复-16"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-16"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("修复一个了在 "),a("code",[e._v("Alpine Linux")]),e._v(" 下的编译错误（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/e989aa34370da73f03627601188ca33844372c4f",target:"_blank",rel:"noopener noreferrer"}},[e._v("e989aa3"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-0-1-2020-12-28"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-1-2020-12-28"}},[e._v("#")]),e._v(" [3.0.1] - 2020-12-28")]),e._v(" "),a("h3",{attrs:{id:"修复-17"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-17"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("修复了一个在检查 Cookie 时的段错误（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/8dc2b56e9a8ae7c22cc5309ac0a060b0358f545b",target:"_blank",rel:"noopener noreferrer"}},[e._v("8dc2b56"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_3-0-0-2020-12-25"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-0-2020-12-25"}},[e._v("#")]),e._v(" [3.0.0] - 2020-12-25")]),e._v(" "),a("h3",{attrs:{id:"新增-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-9"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("CC 防御现在也支持了 IPV6（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/00fbc1c20ec964f6cd3bb992d756737e95b6c7ed",target:"_blank",rel:"noopener noreferrer"}},[e._v("00fbc1c"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("li",[a("p",[e._v("IP 黑白名单支持了 IPV6。可以识别形如 "),a("code",[e._v("fe80::/10")]),e._v(" 的 IPV6 字符串（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/8519b26f5fb9491ac60ae084247a0957c0931d0c",target:"_blank",rel:"noopener noreferrer"}},[e._v("8519b26"),a("OutboundLink")],1),e._v("）。")])])]),e._v(" "),a("h3",{attrs:{id:"改动-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-2"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("删除了一些无用的日志（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bd279e7be872621fa75337722a9fae30b2ea6812",target:"_blank",rel:"noopener noreferrer"}},[e._v("bd279e7"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("li",[a("p",[e._v("友好的错误提示（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/d1185b26a413e45dcf5ef479b0078aa57a4b5962",target:"_blank",rel:"noopener noreferrer"}},[e._v("d1185b2"),a("OutboundLink")],1),e._v(" & "),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/f2b617d5174eb1bc6982113415ddcb1f798ef703",target:"_blank",rel:"noopener noreferrer"}},[e._v("f2b617d"),a("OutboundLink")],1),e._v("）。当规则文件中 IP 地址无效或者 IP 地址块重叠的时候警告或者报错（并不能检测所有的重叠情况）。")])]),e._v(" "),a("li",[a("p",[e._v("更快的 IP 地址检查速度（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/2b9e77404826666df301c3d6b3ce07a6968de266",target:"_blank",rel:"noopener noreferrer"}},[e._v("2b9e774"),a("OutboundLink")],1),e._v("）。改用前缀树检查 IP，现在在常数时间内即可完成 IP 的匹配，之前是一个一个地匹配，是线性时间。")])])]),e._v(" "),a("h3",{attrs:{id:"修复-18"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-18"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("修复了 Cookie 检查的失效的 bug（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/87beed183e404c70411a2d35ea68ebbccccf5ff6",target:"_blank",rel:"noopener noreferrer"}},[e._v("87beed1"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("li",[a("p",[e._v("修改 "),a("code",[e._v("config")]),e._v(" 文件以确保执行 "),a("code",[e._v("make")]),e._v(" 或 "),a("code",[e._v("make modules")]),e._v(" 时最新的模块代码能够被编译（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/25f97f5e7f3792b131ab0ebb1bfe4b7fe5e330ae",target:"_blank",rel:"noopener noreferrer"}},[e._v("25f97f5"),a("OutboundLink")],1),e._v("）。在修复之前，如果仅仅 "),a("code",[e._v("inc/")]),e._v(" 下的文件发生变化，编译时不会将最新的代码编译进去，因为没有检查 "),a("code",[e._v("inc/")]),e._v(" 下的文件是否发生变化。")])]),e._v(" "),a("li",[a("p",[e._v("修复了 IPV4 网段识别错误的 bug（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/73a22eb3538a24e9714bf8331946a5654df20cc1",target:"_blank",rel:"noopener noreferrer"}},[e._v("73a22eb"),a("OutboundLink")],1),e._v("）。这个 bug 可能会导致当规则中出现类似 "),a("code",[e._v("192.168.0.0/10")]),e._v("，即后缀不是 8 的倍数的时候无法正确生成子网掩码。")])])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_2-1-1-2020-12-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-2020-12-10"}},[e._v("#")]),e._v(" [2.1.1] - 2020-12-10")]),e._v(" "),a("h3",{attrs:{id:"新增-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-10"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("h3",{attrs:{id:"改动-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-3"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("h3",{attrs:{id:"修复-19"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-19"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("修复了模块启动失败的 bug。此 bug 的报错信息为 "),a("code",[e._v('nginx: [alert] could not open error log file: open() "ngx_waf: /logs/error.log" failed (2: No such file or directory)')]),e._v("（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/0dfc46f2dfc7ed91977b501c868abf961966d4e1",target:"_blank",rel:"noopener noreferrer"}},[e._v("0dfc46f"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_2-1-0-2020-12-09"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-0-2020-12-09"}},[e._v("#")]),e._v(" [2.1.0] - 2020-12-09")]),e._v(" "),a("h3",{attrs:{id:"新增-11"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-11"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("兼容了 Mainline 版本的 nginx（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/f31f906b11fb00f54bfea504ca7c8c147a0be1d8",target:"_blank",rel:"noopener noreferrer"}},[e._v("f31f906"),a("OutboundLink")],1),e._v(" & "),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/7b4f897a4a332b43bf94de874f8ba8c3098aaee4",target:"_blank",rel:"noopener noreferrer"}},[e._v("65277d1"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("h3",{attrs:{id:"改动-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-4"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("h3",{attrs:{id:"修复-20"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-20"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("h2",{attrs:{id:"_2-0-2-2020-12-07"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-2-2020-12-07"}},[e._v("#")]),e._v(" [2.0.2] - 2020-12-07")]),e._v(" "),a("h3",{attrs:{id:"新增-12"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-12"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("h3",{attrs:{id:"改动-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-5"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("h3",{attrs:{id:"修复-21"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-21"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("修复了一个 CC 防御失效的 bug。此 bug 会导致当 "),a("code",[e._v("waf_mult_mount")]),e._v(" 未启用时，CC 防御会失效（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/048fe5c15863d9a3106387225774305aa5564726",target:"_blank",rel:"noopener noreferrer"}},[e._v("048fe5c"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("li",[a("p",[e._v("修复了一个因错误的 "),a("code",[e._v("#include")]),e._v(" 指令而导致编译失败的 bug（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3fa298c6184618ea0cd6336783a4d7a2ed27469c",target:"_blank",rel:"noopener noreferrer"}},[e._v("3fa298c"),a("OutboundLink")],1),e._v("）。")])])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_2-0-1-2020-12-03"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-1-2020-12-03"}},[e._v("#")]),e._v(" [2.0.1] - 2020-12-03")]),e._v(" "),a("h3",{attrs:{id:"新增-13"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-13"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("h3",{attrs:{id:"改动-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-6"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("ul",[a("li",[e._v("不再手动下载 uthash 依赖，改用 system library。可以使用 "),a("code",[e._v("yum install uthash-devel")]),e._v(" 或 "),a("code",[e._v("apt-get install uthash-dev")]),e._v(" 安装 system library（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/7cfc94bc64fa4f2c29bdf3b24e21aeb1ba412054",target:"_blank",rel:"noopener noreferrer"}},[e._v("7cfc94b"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("h3",{attrs:{id:"修复-22"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-22"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("修复了因为宏的重定义导致的在 CentOS/RHEL 6 or 7 下编译失败的错误（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/28e1c8aca03375089c75df21c5db3c38013edde7",target:"_blank",rel:"noopener noreferrer"}},[e._v("28e1c8a"),a("OutboundLink")],1),e._v(" & "),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/566ae4a50f855674b256db84305a24e1b2a6bc6d",target:"_blank",rel:"noopener noreferrer"}},[e._v("566ae4a"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_2-0-0-2020-09-29"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-0-2020-09-29"}},[e._v("#")]),e._v(" [2.0.0] - 2020-09-29")]),e._v(" "),a("h3",{attrs:{id:"新增-14"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-14"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("支持以动态模块安装到 nginx 上，感谢 "),a("a",{attrs:{href:"https://github.com/dvershinin",target:"_blank",rel:"noopener noreferrer"}},[e._v("dvershinin"),a("OutboundLink")],1),e._v("的 PR（https://github.com/ADD-SP/ngx_waf/pull/4）。")])]),e._v(" "),a("h3",{attrs:{id:"改动-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-7"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("ul",[a("li",[e._v("配置指令合并 ("),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/ba92cfd53ce78da8ff4ed22d2bc71a47de4cbe25",target:"_blank",rel:"noopener noreferrer"}},[e._v("ba92cfd"),a("OutboundLink")],1),e._v(")。这些配置指令将被合并："),a("code",[e._v("waf_check_ipv4")]),e._v("，"),a("code",[e._v("waf_check_url")]),e._v("，"),a("code",[e._v("waf_check_args")]),e._v("，"),a("code",[e._v("waf_check_ua")]),e._v("，"),a("code",[e._v("waf_check_referer")]),e._v("，"),a("code",[e._v("waf_check_cookie")]),e._v("，"),a("code",[e._v("waf_check_post")]),e._v("，"),a("code",[e._v("waf_check_cookie")]),e._v("，"),a("code",[e._v("waf_cc_deny")]),e._v("。合并后的新指令为"),a("code",[e._v("waf_mode")]),e._v("，详情见"),a("RouterLink",{attrs:{to:"/zh-cn/advance/README-ZH.html"}},[e._v("README")]),e._v("。")],1)]),e._v(" "),a("h3",{attrs:{id:"修复-23"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-23"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("删除一个默认的 User-Agent 规则，规则内容为"),a("code",[e._v("(?i)(?:Sogou web spider)")]),e._v("，原因是会拦截非恶意的网络爬虫（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/827d4e5bc48894ff9147e49799d3a9656fe7dd8a",target:"_blank",rel:"noopener noreferrer"}},[e._v("827d4e5"),a("OutboundLink")],1),e._v("）。")]),e._v(" "),a("li",[e._v("现在可以正确处理规则文件中的空行了（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/955cf2d240c4d66f815890e3ee9b88ccf906cf1d",target:"_blank",rel:"noopener noreferrer"}},[e._v("955cf2d"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_1-0-1-2020-08-22"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-1-2020-08-22"}},[e._v("#")]),e._v(" [1.0.1] - 2020-08-22")]),e._v(" "),a("h3",{attrs:{id:"新增-15"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-15"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("增加了新的配置项（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3214fc88d565ed47daa4bdac4f0edb7d1785ed75",target:"_blank",rel:"noopener noreferrer"}},[e._v("3214fc8"),a("OutboundLink")],1),e._v("）\n"),a("ul",[a("li",[e._v("waf_check_ipv4:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_check_ipv4 [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("on")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 IPV4 检查。")])])]),e._v(" "),a("li",[e._v("waf_check_url:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_check_url [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("on")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 URL 检查。")])])]),e._v(" "),a("li",[e._v("waf_check_args:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_check_args [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("on")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 Args 检查。")])])]),e._v(" "),a("li",[e._v("waf_check_ua:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_check_ua [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("on")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 User-Agent 检查。")])])]),e._v(" "),a("li",[e._v("waf_check_referer:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_check_referer [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("on")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 Referer 检查。")])])]),e._v(" "),a("li",[e._v("waf_check_cookie:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_check_cookie [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("on")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 Cookie 检查。")])])]),e._v(" "),a("li",[e._v("waf_check_post:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_check_post [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("off")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 POST 检查。")])])]),e._v(" "),a("li",[e._v("waf_cc_deny:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_cc_deny [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("off")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用 CC 防御。")])])])])])]),e._v(" "),a("h3",{attrs:{id:"改动-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-8"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("waf_mult_mount")]),e._v("现在只允许写在"),a("code",[e._v("server")]),e._v("段中（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3214fc88d565ed47daa4bdac4f0edb7d1785ed75",target:"_blank",rel:"noopener noreferrer"}},[e._v("3214fc8"),a("OutboundLink")],1),e._v("）。\n"),a("ul",[a("li",[e._v("waf_mult_mount:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_mult_mount [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("off")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：进行多阶段检查，当"),a("code",[e._v("nginx.conf")]),e._v("存在地址重写的情况下（如"),a("code",[e._v("rewrite")]),e._v("配置）建议启用，反之建议关闭。")])])])])]),e._v(" "),a("li",[e._v("更改现有的配置项关键字，删除了"),a("code",[e._v("ngx_")]),e._v("前缀（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/8b3e416cdfdc7e073a3392fc9ec027a4138af453",target:"_blank",rel:"noopener noreferrer"}},[e._v("8b3e416"),a("OutboundLink")],1),e._v("）。\n"),a("ul",[a("li",[e._v("waf:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("off")])]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：是否启用本模块。")])])]),e._v(" "),a("li",[e._v("waf_rule_path:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_rule_path dir;")])]),e._v(" "),a("li",[e._v("默认值：无")]),e._v(" "),a("li",[e._v("配置段: server")]),e._v(" "),a("li",[e._v("作用：规则文件所在目录，且必须以"),a("code",[e._v("/")]),e._v("结尾。")])])]),e._v(" "),a("li",[e._v("waf_mult_mount:\n"),a("ul",[a("li",[e._v("配置语法: "),a("code",[e._v("waf_mult_mount [ on | off ];")])]),e._v(" "),a("li",[e._v("默认值："),a("code",[e._v("off")])]),e._v(" "),a("li",[e._v("配置段: http")]),e._v(" "),a("li",[e._v("作用：进行多阶段检查，当"),a("code",[e._v("nginx.conf")]),e._v("存在地址重写的情况下（如"),a("code",[e._v("rewrite")]),e._v("配置）建议启用，反之建议关闭。")])])])])]),e._v(" "),a("li",[e._v("更新 referer 的默认规则，具体一点就是拷贝"),a("code",[e._v("rules/url")]),e._v("的内容到"),a("code",[e._v("rules/referer")]),e._v("中（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/55f5e26b6135af382b1db88057f5143631848ae7",target:"_blank",rel:"noopener noreferrer"}},[e._v("55f5e26"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("h3",{attrs:{id:"修复-24"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-24"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("修复 CC 防御功能检测逻辑的错误，该错误会导致实际的频率限制要远小于用户指定的限制，容易将正常访问识别为 CC 攻击（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/9cb51bba0cdf10c2fd1ac0a482d7435dcfdee93d",target:"_blank",rel:"noopener noreferrer"}},[e._v("9cb51bb"),a("OutboundLink")],1),e._v("）（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/171721cee861022e9f3db5fceeb16051b90a5e54",target:"_blank",rel:"noopener noreferrer"}},[e._v("171721c"),a("OutboundLink")],1),e._v("）。")]),e._v(" "),a("li",[e._v("现在会检查 rules/ipv4 和 rules/white-ipv4 这两个文件中的 IPV4 地址或地址块是否合法（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/fc09f045d1e9ac774a919181a15c20a6c777a276",target:"_blank",rel:"noopener noreferrer"}},[e._v("fc09f04"),a("OutboundLink")],1),e._v("）（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/2e7f624581d8d85a23d6470acced9acc3e2840b2",target:"_blank",rel:"noopener noreferrer"}},[e._v("2e7f624"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("hr"),e._v(" "),a("h2",{attrs:{id:"_1-0-0-2020-08-18"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-0-2020-08-18"}},[e._v("#")]),e._v(" [1.0.0] - 2020-08-18")]),e._v(" "),a("h3",{attrs:{id:"新增-16"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增-16"}},[e._v("#")]),e._v(" 新增")]),e._v(" "),a("ul",[a("li",[e._v("改进日志格式（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bd112ecacd9356ee1e0731634cfc197034d25c88",target:"_blank",rel:"noopener noreferrer"}},[e._v("bd112ec"),a("OutboundLink")],1),e._v("）。基本格式为"),a("code",[e._v("xxxxx, ngx_waf: [拦截类型][对应规则], xxxxx")]),e._v("，具体可看下面的例子。"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('2020/01/20 22:56:30 [alert] 24289#0: *30 ngx_waf: [BLACK-URL][(?i)(?:/\\.env$)], client: 192.168.1.1, server: example.com, request: "GET /v1/.env HTTP/1.1", host: "example.com", referrer: "http:/example.com/v1/.env"\n\n2020/01/20 22:58:40 [alert] 24678#0: *11 ngx_waf: [BLACK-POST][(?i)(?:select.*(?:from|limit))], client: 192.168.1.1, server: example.com, request: "POST /xmlrpc.php HTTP/1.1", host: "example.com", referrer: "https://example.com/"\n')])])])]),e._v(" "),a("li",[e._v("新增三个内置变量（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/92d6d847840ada57bbc54ffe2c0980b118a37a30",target:"_blank",rel:"noopener noreferrer"}},[e._v("92d6d84"),a("OutboundLink")],1),e._v("）\n"),a("ul",[a("li",[a("code",[e._v("$waf_blocked")]),e._v(": 本次请求是否被本模块拦截，如果拦截了则其的值为"),a("code",[e._v("'true'")]),e._v(",反之则为"),a("code",[e._v("'false'")]),e._v("。")]),e._v(" "),a("li",[a("code",[e._v("$waf_rule_type")]),e._v("：如果本次请求被本模块拦截，则其值为触发的规则类型。下面是可能的取值。若没有生效则其值为"),a("code",[e._v("'null'")]),e._v("。\n"),a("ul",[a("li",[a("code",[e._v("'BLACK-IPV4'")])]),e._v(" "),a("li",[a("code",[e._v("'BLACK-URL'")])]),e._v(" "),a("li",[a("code",[e._v("'BLACK-ARGS'")])]),e._v(" "),a("li",[a("code",[e._v("'BLACK-USER-AGENT'")])]),e._v(" "),a("li",[a("code",[e._v("'BLACK-REFERER'")])]),e._v(" "),a("li",[a("code",[e._v("'BLACK-COOKIE'")])]),e._v(" "),a("li",[a("code",[e._v("'BLACK-POST'")])])])]),e._v(" "),a("li",[a("code",[e._v("'$waf_rule_details'")]),e._v("：如果本次请求被本模块拦截，则其值为触发的具体的规则的内容。若没有生效则其值为"),a("code",[e._v("'null'")]),e._v("。")])])]),e._v(" "),a("li",[e._v("支持过滤 POST 请求（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/b46641eb8473c6dcb6afe9ed73f94712300d176f",target:"_blank",rel:"noopener noreferrer"}},[e._v("b46641e"),a("OutboundLink")],1),e._v("）。")]),e._v(" "),a("li",[e._v("新配置项"),a("code",[e._v("ngx_waf_mult_mount")]),e._v("用于增加拦截面（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/e1b500de349e017b67f334878342bdd6a34d22b8",target:"_blank",rel:"noopener noreferrer"}},[e._v("e1b500d"),a("OutboundLink")],1),e._v("），典型的应用场景是存在"),a("code",[e._v("rewrite")]),e._v("的情况下重写前后均会对 URL 进行一次检测。")]),e._v(" "),a("li",[e._v("支持 CC 防御功能（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3a93e190b8cb78fcd7a0197f76298c010169d113",target:"_blank",rel:"noopener noreferrer"}},[e._v("3a93e19"),a("OutboundLink")],1),e._v("）。")])]),e._v(" "),a("h3",{attrs:{id:"改动-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动-9"}},[e._v("#")]),e._v(" 改动")]),e._v(" "),a("ul",[a("li",[e._v("增加默认的 POST 过滤规则（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/68dd102e011acfd819669d60a35d315365d26a16",target:"_blank",rel:"noopener noreferrer"}},[e._v("68dd102"),a("OutboundLink")],1),e._v("）")]),e._v(" "),a("li",[e._v("更新默认规则（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/55f0a4824bafb67f562909bdb58292cfce1059ae",target:"_blank",rel:"noopener noreferrer"}},[e._v("55f0a48"),a("OutboundLink")],1),e._v("）。")]),e._v(" "),a("li",[e._v("修改规则优先级（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3c388c85e30528b66306ca780524c7d663277f07",target:"_blank",rel:"noopener noreferrer"}},[e._v("3c388c8"),a("OutboundLink")],1),e._v("）（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/248958d3a0ef27dd14acc63a503e97931841f18a",target:"_blank",rel:"noopener noreferrer"}},[e._v("248958d"),a("OutboundLink")],1),e._v("）（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/b46641eb8473c6dcb6afe9ed73f94712300d176f",target:"_blank",rel:"noopener noreferrer"}},[e._v("b46641e"),a("OutboundLink")],1),e._v("）（(92447a3)[https://github.com/ADD-SP/ngx_waf/commit/92447a39d6a36ab027b0ead0daa0fe2b3b74ff29]），现在的优先级为（靠上的优先生效）：\n"),a("ol",[a("li",[e._v("IP 白名单")]),e._v(" "),a("li",[e._v("IP 黑名单")]),e._v(" "),a("li",[e._v("CC 防御")]),e._v(" "),a("li",[e._v("URL 白名单")]),e._v(" "),a("li",[e._v("URL 黑名单")]),e._v(" "),a("li",[e._v("Args 黑名单")]),e._v(" "),a("li",[e._v("UserAgent 黑名单")]),e._v(" "),a("li",[e._v("Referer 白名单")]),e._v(" "),a("li",[e._v("Referer 黑名单")]),e._v(" "),a("li",[e._v("Cookie 黑名单")]),e._v(" "),a("li",[e._v("POST 黑名单")])])])]),e._v(" "),a("h3",{attrs:{id:"修复-25"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复-25"}},[e._v("#")]),e._v(" 修复")]),e._v(" "),a("ul",[a("li",[e._v("IPV4 黑白名单功能失效（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/231f94aa5383fe8f6cdc0fbc3cd2dcadb7606881",target:"_blank",rel:"noopener noreferrer"}},[e._v("231f94a"),a("OutboundLink")],1),e._v("）。")]),e._v(" "),a("li",[e._v("当 User-agent 为空时会触发 segmentation fault（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bf33b366232b7f5e05379d5e10ab006696189ea6",target:"_blank",rel:"noopener noreferrer"}},[e._v("bf33b36"),a("OutboundLink")],1),e._v("）。")]),e._v(" "),a("li",[e._v("启用 CC 防御后会有内存泄漏（"),a("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/be58d189b4c95be066623604124b02a9bf174e7f",target:"_blank",rel:"noopener noreferrer"}},[e._v("be58d18"),a("OutboundLink")],1),e._v("）。")])])])}),[],!1,null,null,null);t.default=r.exports}}]);