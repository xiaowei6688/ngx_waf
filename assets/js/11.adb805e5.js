(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{387:function(t,s,e){"use strict";e.r(s);var a=e(44),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#log"}},[t._v("#")]),t._v(" Log")]),t._v(" "),e("h2",{attrs:{id:"blocking-log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#blocking-log"}},[t._v("#")]),t._v(" Blocking Log")]),t._v(" "),e("p",[t._v("The blocking log is stored in "),e("code",[t._v("error.log")]),t._v(". The log level of the blocking log is "),e("code",[t._v("ALERT")]),t._v(".\nThe format is "),e("code",[t._v("ngx_waf: [rule type][specific rule triggered]")]),t._v(".")]),t._v(" "),e("p",[t._v("You can use the following command to quickly view the blocking log.")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /path/to/error.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" ngx_waf:\n")])])]),e("p",[t._v("Here are two examples.")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('2020/01/20 22:56:30 [alert] 6666#0: *30 ngx_waf: [BLACK-URL][(?i)(?:/\\.env$)], client: 192.168.1.1, server: example.com, request: "GET /v1/.env HTTP/1.1", host: "example.com", referrer: "http:/example.com/v1/.env"\n\n2020/01/20 22:58:40 [alert] 6667#0: *11 ngx_waf: [BLACK-POST][(?i)(?:select.+(?:from|limit))], client: 192.168.1.1, server: example.com, request: "POST /xmlrpc.php HTTP/1.1", host: "example.com", referrer: "https://example.com/"\n')])])]),e("h2",{attrs:{id:"debugging-log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#debugging-log"}},[t._v("#")]),t._v(" Debugging Log")]),t._v(" "),e("p",[t._v("When you adjust the error log level to "),e("code",[t._v("debug")]),t._v(" in the nginx configuration file,\nthe debug log will be output in "),e("code",[t._v("error.log")]),t._v(" for troubleshooting purposes.\nfor troubleshooting purposes. The format is "),e("code",[t._v("ngx_waf_debug: debug information")]),t._v(".")]),t._v(" "),e("p",[t._v("You can use the following command to quickly view the debug log.")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /path/to/error.log "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" ngx_waf_debug:\n")])])]),e("p",[t._v("Below is a typical modulation log that illustrates the flow of a CC defense detection.")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: Start the CC inspection process.\n2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: The module context has been obtained.\n2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: The configuration of the module has been obtained.\n2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: Detection has begun.\n2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: Shared memory is locked.\n2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: Shared memory is unlocked.\n2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: Detection is over.\n2021/02/21 20:35:33 [debug] 6666#0: *1 ngx_waf_debug: The CC detection process is fully completed.\n")])])]),e("h2",{attrs:{id:"customised-log-format"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#customised-log-format"}},[t._v("#")]),t._v(" Customised Log Format")]),t._v(" "),e("p",[t._v("nginx allows custom log formats, and a server block can write to multiple log files at the same time,\ngiving us the opportunity to customise our log formats.\nThis module provides some "),e("RouterLink",{attrs:{to:"/advance/variable.html"}},[t._v("built-in Variables")]),t._v("\nthat can be used to customise the blocking log with a little effort.")],1),t._v(" "),e("p",[t._v("Here is an example.")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_format")]),t._v("  main    "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_format")]),t._v(" yaml     "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'- remote_addr: \"$remote_addr\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  remote_user: \"$remote_user\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  time_local: \"$time_local\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  request: \"$request\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  status: \"$status\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  body_bytes_sent: \"$body_bytes_sent\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  http_referer: \"$http_referer\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  http_user_agent: \"$http_user_agent\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  http_x_forwarded_for: \"$http_x_forwarded_for\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  waf_blocked: $waf_blocked\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  waf_spend: $waf_spend\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  waf_rule_type: \"$waf_rule_type\"\\n'")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'  waf_rule_details: \"$waf_rule_details\"\\n'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v("  logs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("access"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  main"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v("  logs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("access"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml  yaml   "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$waf_log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v("  logs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("waf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml     yaml   "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$waf_blocking_log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),e("p",[t._v("The above configuration stores the normal log format in "),e("code",[t._v("logs/access.log")]),t._v(",\nwhile the yaml format logs are stored in "),e("code",[t._v("logs/access.yml")]),t._v(".\nIt is worth noting that yaml format logs use the three built-in variables provided by the module.\nYou can easily read `logs/access.The above configuration will have the following effect.")]),t._v(" "),e("ul",[e("li",[t._v("normal access logs are written to "),e("code",[t._v("logs/access.log")]),t._v(".")]),t._v(" "),e("li",[t._v("YAML-formatted access logs are written to "),e("code",[t._v("logs/access.yml")]),t._v(".")]),t._v(" "),e("li",[t._v("YAML-formatted intercept logs are written to "),e("code",[t._v("logs/waf.yml")]),t._v(".")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Log analysis")]),t._v(" "),e("p",[t._v("You can customize the log format, and then programmatically analyze it and make statistical graphs.")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("ABOUT YAML FORMAT")]),t._v(" "),e("p",[t._v("YAML is a highly readable data serialisation format that is very easy to learn.\nAs long as you can read JSON, learning YAML will be a snap.\nYou can search for a description of the YAML format yourself.")])])])}),[],!1,null,null,null);s.default=n.exports}}]);